# Section 29 Angular as a Platform & Closer Look at the CLI

## Angular as a Platform and Angular CLI

### Lesson 431 - Module Introduction

Apart from the Angular Framework and the code, the Angular Platform and CLI also provide useful features that can help building the application.

This module covers

- Angular Projects and Configs
- Creating and managing projects
- Schematics and Builders
- Projects, Apps and Libraries
- Etc

### Lesson 432 - A Closer Look at "ng new"

`ng new` is used for creating new Angular projects. Use `ng new --help` to view the help message that contains a list of available flags and their descriptions. More information on the Angular CLI can be found on [Angular's official documentation website](https://angular.io/cli)

Use `ng new <projectName>` to create an Angular project for this section.

### Lesson 433 - IDE & Project Setup

VSCode setups

### Lesson 434 - Understanding the Config Files

Configuration files included in the project

`.editorconfig` - File used by IDE for code styles

`browserslist` - Angular CLI will use this file to determine which browsers and their versions to build the project for production

- Each browser will have a different requirement for the generated bundle and polyfill files

`karma.conf.js` - File used for fine-tuning Unit Test configurations

`package-lock.json` - File generated by npm when installing packages from `package.json`

`package.json` - File containing scripts, dependencies and devDependencies that the npm project uses

`tsconfig.json` - Configurations for TypeScript Compiler for the project

- `angularCompilerOptions` is not for TS, but for the Angular Compiler instead
  - The Angular Compiler compiles the compiled JS (from TS compiler) and the template into instructions that can be run in the browser at runtime

`tslint.json` - Linter config for TS

`angular.json` - Covered in later lesson

### Lesson 435 - Important CLI Commands

From within the project, there are also some important Angular CLI commands. Use `ng help` to get a list of available commands and their descriptions. All commands can be appended with `--help` to get a more detailed command for the current command.

- `ng serve` - Serve the application
- `ng generate` - Generate building blocks for the application
- `ng build` - Build the application
- `ng lint` - Use the config saved in `tslint.json` to lint through the application

### Lesson 436 - The "angular.json" File - A Closer Look

The `angular.json` contains the configurations used by the CLI for running its commands

- `newProjectRoot` - The project root to add new projects to

- `projects` - A list of projects with their names as key, and configurations as JSON object values

  - `projectType` - The type of the application, either `application` or `library`
  - `schematics` - Covered in the next lesson
  - `root` - The root folder for the project
  - `prefix` - The prefix used before all component (e.g. `app` -> `app-user`)
  - `architect` - The configurations for all different CLI commands

    - `build`, `serve`, `extract-i18n`, `test`, `lint`, `e2e`, etc

      - `builder` - The builder for building the project
      - `options` - The default options for the command that will always be included when the command is run
      - `configurations` - configurations for different environments

        - E.g. `fileReplacements` replaces the `environment.ts` file with `environment.prod.ts` file depending on the environment
        - Options specified in `configurations` overrides options specified in `options`

- `defaultProject` - The default project the CLI will run command against

  - Should be one of the project names specified in `projects`

### Lesson 437 - Angular Schematics - An Introduction

Angular CLI Schematics are blueprints which certain CLI commands can pick up. These Schematics can be built by the developers or by other third party packages

### Lesson 438 - The "ng add" Command

Angular Material is a third party package maintained by part of the Angular team. It allows developers to add pre-built components following the Material Design spec. To add it to the project, use `ng add @angular/material`. Note that all parties can support the `ng add` command, as long as they provide certain configuration files that Angular uses.

In the case of Angular Material, running the `ng add` command results in the following outcome

1. The package is installed using npm
2. The package prompts for configurations
3. The package updates `package.json`
4. The package updates other files such as `app.module.ts`, `angular.json`, `src/index.html` and `src/styles.css`

These steps are defined by Angular Material so that by running `ng add`, most configurations are already done and consumers can start using the package relatively painlessly

### Lesson 439 - Using Custom "ng generate" Schematics

Developers or third party packages can also define Schematics for `ng generate`. E.g. With Angular Material installed, `ng generate @angular/material:nav main-nav` will generate a `MainNav` component using the `nav` template defined by Angular Material.

In `app.component.html`

- Include the generated `MainNav` component

```html
<app-main-nav></app-main-nav>
```

By running `ng serve` we can see that everything works out of the box.

### Lesson 440 - Smooth Updating of Projects with "ng update"

`ng update` analyzes the Angular project and displays a table to show whether there is a package that can or needs to be updated and how. For Angular packages, this works by default. For third party packages, the packages need to have their custom schematics to support `ng update`.

With `ng update <package>`, Angular CLI will run migration scripts to update the package to the latest version.

### Lesson 441 - Simplified Deployment with "ng deploy"

**Builder**s are commands that perform certain build steps. Some examples are `ng build`, `ng test`, `ng lint`, `ng deploy`.

`ng deploy` is a more convenient builder. It builds the application for production, and deploy it to a certain host. A third party package or tool needs to be included that contains a builder that supports the `ng deploy` command.

For this example, Firebase hosting (`@angular/fire`) is used. To include Firebase in the project, run `ng add @angular/fire`. After the Firebase package is added, by running `ng deploy`, Angular will pick up the Firebase builder, build the project in production mode, and automatically deploy to Firebase and return a URL.

### Lesson 442 - Understanding "Differential Loading"

**Differential Loading** is a feature supported by Angular CLI that loads different builds depending on the browser and their versions. For modern browsers, there is no/less need for polyfills, so the required bundle has a smaller size. For legacy browsers, there is a larger need for more/all polyfills, and thus the bundle will have a larger size. **Polyfills** are files that enable browsers for certain features.

Angular CLI produces multiple versions of the bundles when the app gets built for production. When the user accesses the application page, Angular first runs a small piece of code to determine the browser and the version, and decide which version of the application to serve.

The advantage for this is that a user using a modern browser can download a smaller bundle to run the Angular app, so the load time is faster.

In the build folder (`/dist/`), we can find the same JS files but for different versions. File names containing `es5` are for older browser versions, where as `es2015` files are for modern browser versions.

Differential Loading can be configured using the `browserslist` and `tsconfig.json` files.

In `browserslist`, a list of supported browsers are specified, where as in `tsconfig.json`, developers can specify the target JS version to support using the `target` attribute.

### Lesson 443 - Managing Multiple Projects in One Folder

An Angular project can contain multiple projects and libraries. To do so, use `ng generate <application/library> <projectName>`.

To generate a new project, use `ng generate application <projectName>`.

By default, Angular will create a `projects` folder containing the new project, and `angular.json` will also be updated to include the new project. To run any Angular CLI command on the non-default projects, use `--project=<projectName>` (E.g. `ng serve --project=projectName`).

To create multiple Angular projects under one root, do the following

- `ng new <rootProjectName> --create-application=false` - this creates an empty Angular project, with no application in it
- `ng generate application <projectName>` - this creates a Project under the `projects` folder, so all projects will live under the same root
